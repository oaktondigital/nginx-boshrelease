---
name: nginx

templates:
  ctl.sh: bin/ctl
  nginx.conf.erb: etc/nginx.conf
  pre-start.erb: bin/pre-start
  fastcgi_params.erb: etc/fastcgi_params


packages:
  - nginx

properties:
  nginx_worker_processes:
    description: Nginx worker processes count
    default: 1
  nginx_worker_connections:
    description: Nginx worker connections
    default: 1024
  nginx_log_format_name:
    description: log_format name
    default: main
  nginx_log_format:
    description: log_format used in nginx
    default: '$remote_addr - $remote_user [$time_local]  $status "$request" $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"'
  nginx_servers:
    description: servers
    default:
      - |
        server {
          server_name localtest.local;
          listen 80;
          access_log /var/vcap/sys/log/nginx/access.log main;
          error_log /var/vcap/sys/log/nginx/error.log;
          root /var/vcap/store/nginx/www/document_root;
          index index.php index.html index.html;
          location / {
              try_files $uri $uri/ =404;
          }
          location ~ \.php$ {
              try_files $uri =404;
              fastcgi_split_path_info ^(.+\.php)(/.+)$;
              fastcgi_pass 127.0.0.1:9000;
              fastcgi_index index.php;
              fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
              include fastcgi_params;
          }
        }

